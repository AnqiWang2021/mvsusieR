<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to mvSuSiE for multi-trait fine-mapping • mvsusieR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to mvSuSiE for multi-trait fine-mapping">
<meta property="og:description" content="mvsusieR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mvsusieR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.3.0529</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/stephenslab/mvsusieR" class="external-link">Source</a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to mvSuSiE for multi-trait
fine-mapping</h1>
                        <h4 data-toc-skip class="author">Yuxin Zou, Gao
Wang, Peter Carbonetto and Matthew Stephens</h4>
            
            <h4 data-toc-skip class="date">2023-03-27</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/stephenslab/mvsusieR/blob/HEAD/vignettes/mvsusie_intro.Rmd" class="external-link"><code>vignettes/mvsusie_intro.Rmd</code></a></small>
      <div class="hidden name"><code>mvsusie_intro.Rmd</code></div>

    </div>

    
    
<p>The aim of this vignette is to work through the steps of a basic
mvSuSiE multi-trait fine-mapping analysis. We analyze a simulated
fine-mapping data set with realistic genotypes.</p>
<p>First, load the necessary packages, and to ensure reproducibility set
the seed.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/stephenslab/mvsusieR" class="external-link">mvsusieR</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/" class="external-link">cowplot</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>Next, load the data set we will analyze.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">simdata</span><span class="op">)</span></code></pre></div>
<p>The data consist of an <span class="math inline">\(N \times
J\)</span> genotype matrix <code>X</code> and an <span class="math inline">\(N \times R\)</span> phenotype matrix
<code>Y</code> where <span class="math inline">\(N\)</span> is the
number of samples, <span class="math inline">\(J\)</span> is the number
of SNPs, and <span class="math inline">\(R\)</span> is the number of
traits/phenotypes.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">X</span> <span class="op">&lt;-</span> <span class="va">simdata</span><span class="op">$</span><span class="va">raw</span><span class="op">$</span><span class="va">X</span>
<span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">simdata</span><span class="op">$</span><span class="va">raw</span><span class="op">$</span><span class="va">Y</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span>
<span class="co"># [1]  574 1001</span>
<span class="co"># [1] 574  20</span></code></pre></div>
<div class="section level2">
<h2 id="specify-the-prior">Specify the prior<a class="anchor" aria-label="anchor" href="#specify-the-prior"></a>
</h2>
<p>Some care should be taken to choose the prior for your mvSuSiE
analysis. To simplify the example we have defined the prior for you:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_mixture_prior.html">create_mixture_prior</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>matrices <span class="op">=</span> <span class="va">simdata</span><span class="op">$</span><span class="va">par</span><span class="op">$</span><span class="va">U</span>,
                                   weights <span class="op">=</span> <span class="va">simdata</span><span class="op">$</span><span class="va">par</span><span class="op">$</span><span class="va">w</span><span class="op">)</span>,
                              null_weight <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
<p>More generally, we recommend taking a “data-driven” approach to
estimating the weights and the covariance matrices in the prior. For
example, when there are many candidate fine-mapping regions in your
study, you could fit the prior to all the top associations from each of
the candidate fine-mapping regions. This data-driven approach is quite
similar to the approach used in <a href="https://github.com/stephenslab/mashr" class="external-link">mashr</a>, and we recommend
looking through the vignettes in the mashr package for further
guidance.</p>
</div>
<div class="section level2">
<h2 id="fit-the-mvsusie-model">Fit the mvSuSiE model<a class="anchor" aria-label="anchor" href="#fit-the-mvsusie-model"></a>
</h2>
<p>Now that we have set up the prior, we are ready to run mvsusie:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mvsusie.html">mvsusie</a></span><span class="op">(</span><span class="va">X</span>,<span class="va">Y</span>,standardize <span class="op">=</span> <span class="cn">TRUE</span>,
               prior_variance <span class="op">=</span> <span class="va">prior</span>,
               residual_variance <span class="op">=</span> <span class="va">simdata</span><span class="op">$</span><span class="va">par</span><span class="op">$</span><span class="va">V</span>,
               estimate_prior_variance <span class="op">=</span> <span class="cn">TRUE</span>,
               tol <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>
<span class="co"># Initializing data object...</span>
<span class="co"># Dimension of X matrix: 574 1001</span>
<span class="co"># Dimension of Y matrix: 574 20</span>
<span class="co"># Initializing prior object ...</span>
<span class="co"># Number of components in the mixture prior: 20</span>
<span class="co"># Memory used by data object 0.011 GB</span>
<span class="co"># Memory used by prior object 0 GB</span>
<span class="co"># Running IBSS algorithm...</span>
<span class="co"># Iteration 1 delta = Inf</span>
<span class="co"># Iteration 2 delta = 31.0117608064538</span>
<span class="co"># Iteration 3 delta = 1.45487855527062</span>
<span class="co"># Iteration 4 delta = 0.676754236554189</span>
<span class="co"># Iteration 5 delta = 0.43271464830832</span>
<span class="co"># Iteration 6 delta = 0.308027641538501</span>
<span class="co"># Iteration 7 delta = 0.234364249556165</span>
<span class="co"># Iteration 8 delta = 0.18638943089536</span>
<span class="co"># Iteration 9 delta = 0.152773426967542</span>
<span class="co"># Iteration 10 delta = 0.127958230748845</span>
<span class="co"># Iteration 11 delta = 0.190949569805525</span>
<span class="co"># Iteration 12 delta = 0.438205737898897</span>
<span class="co"># Iteration 13 delta = 0.0164586528208019</span>
<span class="co"># Iteration 14 delta = 0.0155586413329729</span>
<span class="co"># Iteration 15 delta = 0.0147936737121199</span>
<span class="co"># Iteration 16 delta = 0.0138843746408384</span>
<span class="co"># Iteration 17 delta = 0.0126234407434822</span>
<span class="co"># Iteration 18 delta = 0.0109375095908035</span>
<span class="co"># Iteration 19 delta = 0.00896087709406856</span></code></pre></div>
<p>In this call, we have provided mvSuSiE with the four key pieces of
information need to run the analysis: (1) the genotype matrix; (2) the
phenotype matrix, (3) the prior on the effects; and (4) the residual
variance-covariance matrix (an <span class="math inline">\(R \times
R\)</span> matrix).</p>
<p>The “tol” parameter tells the IBSS model fitting algorithm when to
stop iterating; for a final analysis, you may want to set a more
stringent tolerance (a number closer to zero).</p>
</div>
<div class="section level2">
<h2 id="identifying-the-causal-snps-credible-sets">Identifying the causal SNPs: Credible Sets<a class="anchor" aria-label="anchor" href="#identifying-the-causal-snps-credible-sets"></a>
</h2>
<p>By default, the “mvsusie” function fits a model with L = 10 single
effects. mvSuSiE is generally robust to misspecification of L so long as
L is chosen to be larger than the true number of effects. mvSuSiE prunes
unneeded single effects by estimating a scaling coefficient in the
prior; we set <code>estimate_prior_variance = TRUE</code> to turn on
this pruning step. Indeed, mvsusie pruned 7 out of 10 of the single
effects, resulting in three 95% credible sets (CSs), each of which
contain exactly one of the true causal SNPs:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit</span><span class="op">$</span><span class="va">sets</span><span class="op">$</span><span class="va">cs</span>
<span class="co"># $L1</span>
<span class="co"># [1] 335</span>
<span class="co"># </span>
<span class="co"># $L2</span>
<span class="co"># [1] 255</span>
<span class="co"># </span>
<span class="co"># $L3</span>
<span class="co"># [1] 481 484 493 494 499 508 509 512</span></code></pre></div>
<p>In the third CS, mvSuSiE cannot decide which SNP is the causal SNP
because the candidate SNPs are strongly correlated with each other:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit</span><span class="op">$</span><span class="va">sets</span><span class="op">$</span><span class="va">purity</span>
<span class="co">#    min.abs.corr mean.abs.corr median.abs.corr</span>
<span class="co"># L1    1.0000000     1.0000000       1.0000000</span>
<span class="co"># L2    1.0000000     1.0000000       1.0000000</span>
<span class="co"># L3    0.9559005     0.9803777       0.9801855</span></code></pre></div>
<p>Examining the posterior inclusion probabilties (PIPs) for these SNPs,
there is a subset of 3 SNPs that account for &gt;58% of probability for
being causal:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">markers</span> <span class="op">&lt;-</span> <span class="va">fit</span><span class="op">$</span><span class="va">sets</span><span class="op">$</span><span class="va">cs</span><span class="op">$</span><span class="va">L3</span>
<span class="va">fit</span><span class="op">$</span><span class="va">pip</span><span class="op">[</span><span class="va">markers</span><span class="op">]</span>
<span class="co">#       v481       v484       v493       v494       v499       v508       v509 </span>
<span class="co"># 0.02205462 0.16625677 0.39305212 0.16937313 0.02670885 0.04688452 0.07230198 </span>
<span class="co">#       v512 </span>
<span class="co"># 0.07009722</span></code></pre></div>
<p>Additionally, the “sentinel” SNP—the SNP with the highest PIP—as a
PIP of nearly 40%.</p>
<p>This is all summarized visually in a “PIP plot”:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/mvsusie_plot_simple.html">mvsusie_plot_simple</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">$</span><span class="va">pip_plot</span></code></pre></div>
<p><img src="mvsusie_intro_files/figure-html/pip-plot-1.png" width="720" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="determining-which-traits-are-affected">Determining which traits are affected<a class="anchor" aria-label="anchor" href="#determining-which-traits-are-affected"></a>
</h2>
<p>In a multi-trait analysis, we are not just interested in identifying
the causal SNPs, but also <em>which traits</em> are affected by these
causal SNPs.</p>
<p>Let’s take the first CS as an example. This is an example of a causal
SNP that affects most traits:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">l</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">i</span> <span class="op">&lt;-</span> <span class="fl">335</span>
<span class="va">pdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>bhat <span class="op">=</span> <span class="va">simdata</span><span class="op">$</span><span class="va">Btrue</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span>,
                   coef <span class="op">=</span> <span class="va">fit</span><span class="op">$</span><span class="va">b1_rescaled</span><span class="op">[</span><span class="va">l</span>,<span class="va">i</span><span class="op">+</span><span class="fl">1</span>,<span class="op">]</span>,
                   lfsr <span class="op">=</span> <span class="va">fit</span><span class="op">$</span><span class="va">single_effect_lfsr</span><span class="op">[</span><span class="va">l</span>,<span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pdat</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bhat</span>,y <span class="op">=</span> <span class="va">coef</span>,color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">lfsr</span><span class="op">)</span>,pch <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">20</span>,size <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span>,slope <span class="op">=</span> <span class="fl">1</span>,color <span class="op">=</span> <span class="st">"black"</span>,linetype <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradient2</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"lightskyblue"</span>,mid <span class="op">=</span> <span class="st">"gold"</span>,high <span class="op">=</span> <span class="st">"orangered"</span>,
                        midpoint <span class="op">=</span> <span class="op">-</span><span class="fl">40</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"true coef"</span>,y <span class="op">=</span> <span class="st">"mvsusie estimate"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/theme_cowplot.html" class="external-link">theme_cowplot</a></span><span class="op">(</span>font_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></code></pre></div>
<p><img src="mvsusie_intro_files/figure-html/unnamed-chunk-1-1.png" width="420" style="display: block; margin: auto;"></p>
<p>Indeed, the effects of this causal SNP are significant—<em>i.e.,</em>
small local false sign rates—for most of the 20 traits. (A local false
sign rate can be thought of as an alternative to a <em>p</em>-value, but
is typically slightly more conservative than a <em>p</em>-value.)</p>
<p>Also, it is reassuring that the mvsusie estimates of the coefficients
align well with the coefficients used to simulate the data.</p>
<p>By contrast, the causal SNP identified by the third CS only affects
one trait, and the affected trait was correctly identified by
mvsusie:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">l</span> <span class="op">&lt;-</span> <span class="fl">3</span>
<span class="va">i</span> <span class="op">&lt;-</span> <span class="fl">493</span>
<span class="va">pdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>bhat <span class="op">=</span> <span class="va">simdata</span><span class="op">$</span><span class="va">Btrue</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span>,
                   coef <span class="op">=</span> <span class="va">fit</span><span class="op">$</span><span class="va">b1_rescaled</span><span class="op">[</span><span class="va">l</span>,<span class="va">i</span><span class="op">+</span><span class="fl">1</span>,<span class="op">]</span>,
                   lfsr <span class="op">=</span> <span class="va">fit</span><span class="op">$</span><span class="va">single_effect_lfsr</span><span class="op">[</span><span class="va">l</span>,<span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pdat</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bhat</span>,y <span class="op">=</span> <span class="va">coef</span>,color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">lfsr</span><span class="op">)</span>,pch <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">20</span>,size <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradient2</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"lightskyblue"</span>,mid <span class="op">=</span> <span class="st">"gold"</span>,high <span class="op">=</span> <span class="st">"orangered"</span>,
                        midpoint <span class="op">=</span> <span class="op">-</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"true coef"</span>,y <span class="op">=</span> <span class="st">"mvsusie estimate"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/theme_cowplot.html" class="external-link">theme_cowplot</a></span><span class="op">(</span>font_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></code></pre></div>
<p><img src="mvsusie_intro_files/figure-html/unnamed-chunk-2-1.png" width="420" style="display: block; margin: auto;"></p>
<p>Notice that the lfsr is very small for the first trait (&lt;1e-6)
whereas the lfsrs for the rest of the traits are all close to 1.</p>
<p>The information about which traits are affected by the causal SNP is
summarized in the “effect plot”:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mvsusie_plot_simple.html">mvsusie_plot_simple</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>
<span class="va">out</span><span class="op">$</span><span class="va">effect_plot</span></code></pre></div>
<p><img src="mvsusie_intro_files/figure-html/effect-plot-1.png" width="300" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="mvsusie-with-summary-data-mvsusie-rss">mvSuSiE with summary data: mvSuSiE-RSS<a class="anchor" aria-label="anchor" href="#mvsusie-with-summary-data-mvsusie-rss"></a>
</h2>
<p>mvsusieR also provides a “summary data” interface, building on the
ideas developed in the <a href="https://doi.org/10.1371/journal.pgen.1010299" class="external-link">susie-rss paper</a>.
Different combinations of summary statistics are accepted, but here we
will focus on the most common case in which the <em>z</em>-scores from
the association tests are used. These <em>z</em>-scores should be stored
in a <span class="math inline">\(J \times R\)</span> matrix:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Z</span> <span class="op">&lt;-</span> <span class="va">simdata</span><span class="op">$</span><span class="va">sumstats</span><span class="op">$</span><span class="va">z</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span>
<span class="co"># [1] 1001   20</span></code></pre></div>
<p>In addition to the <em>z</em>-scores, the sample size and <span class="math inline">\(R \times R\)</span> LD (correlation) matrix are
needed. (Strictly speaking, the sample size is not required, but the
estimates may be less accurate if the sample size is not provided.)</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n</span> <span class="op">&lt;-</span> <span class="va">simdata</span><span class="op">$</span><span class="va">sumstats</span><span class="op">$</span><span class="va">n</span>
<span class="va">R</span> <span class="op">&lt;-</span> <span class="va">simdata</span><span class="op">$</span><span class="va">sumstats</span><span class="op">$</span><span class="va">LD</span></code></pre></div>
<p>Now we can fit an mvSuSiE model to these summary data via the
<code>mvsusie_rss</code> interface:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit_rss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mvsusie.html">mvsusie_rss</a></span><span class="op">(</span><span class="va">Z</span>,<span class="va">R</span>,<span class="va">n</span>,
                       prior_variance <span class="op">=</span> <span class="va">prior</span>,
                       residual_variance <span class="op">=</span> <span class="va">simdata</span><span class="op">$</span><span class="va">par</span><span class="op">$</span><span class="va">V</span>,
                       estimate_prior_variance <span class="op">=</span> <span class="cn">TRUE</span>,
                       tol <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>
<span class="co"># Initializing prior object ...</span>
<span class="co"># Number of components in the mixture prior: 20</span>
<span class="co"># Memory used by data object 0.014 GB</span>
<span class="co"># Memory used by prior object 0 GB</span>
<span class="co"># Running IBSS algorithm...</span>
<span class="co"># Iteration 1 delta = Inf</span>
<span class="co"># Iteration 2 delta = 31.0117608064538</span>
<span class="co"># Iteration 3 delta = 1.45487855527244</span>
<span class="co"># Iteration 4 delta = 0.67675423655237</span>
<span class="co"># Iteration 5 delta = 0.432714648310139</span>
<span class="co"># Iteration 6 delta = 0.308027641538501</span>
<span class="co"># Iteration 7 delta = 0.234364249556165</span>
<span class="co"># Iteration 8 delta = 0.186389430897179</span>
<span class="co"># Iteration 9 delta = 0.152773426965723</span>
<span class="co"># Iteration 10 delta = 0.127958230750664</span>
<span class="co"># Iteration 11 delta = 0.190949569801887</span>
<span class="co"># Iteration 12 delta = 0.438205737900716</span>
<span class="co"># Iteration 13 delta = 0.0164586528226209</span>
<span class="co"># Iteration 14 delta = 0.0155586413311539</span>
<span class="co"># Iteration 15 delta = 0.0147936737121199</span>
<span class="co"># Iteration 16 delta = 0.0138843746390194</span>
<span class="co"># Iteration 17 delta = 0.0126234407434822</span>
<span class="co"># Iteration 18 delta = 0.0109375095944415</span>
<span class="co"># Iteration 19 delta = 0.00896087709406856</span></code></pre></div>
<p>The call to <code>mvsusie_rss</code> is very similar to the call to
<code>mvsusie</code> above, except that the individual-level data are
replaced with summary data.</p>
<p>When the genotypes are standardized in <code>mvsusie</code>
(<code>standardize = TRUE</code>) and the LD estimates are obtained from
the same data that were used to compute the <em>z</em>-scores, both
<code>mvsusie</code> and <code>mvsusie_rss</code> should give the same
result:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>b1     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">b1</span><span class="op">)</span>,
                   b1_rss <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">fit_rss</span><span class="op">$</span><span class="va">b1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pdat</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">b1</span>,y <span class="op">=</span> <span class="va">b1_rss</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">20</span>,size <span class="op">=</span> <span class="fl">2</span>,color <span class="op">=</span> <span class="st">"royalblue"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span>,slope <span class="op">=</span> <span class="fl">1</span>,color <span class="op">=</span> <span class="st">"black"</span>,linetype <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"mvsusie"</span>,y <span class="op">=</span> <span class="st">"mvsusie_rss"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/theme_cowplot.html" class="external-link">theme_cowplot</a></span><span class="op">(</span>font_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></code></pre></div>
<p><img src="mvsusie_intro_files/figure-html/raw-vs-summary-1.png" width="300" style="display: block; margin: auto;"></p>
<p>Of course, the result is not always expected to be the same—for
example, when the LD is estimated from an external reference panel.</p>
</div>
<div class="section level2">
<h2 id="estimating-the-residual-variance">Estimating the residual variance<a class="anchor" aria-label="anchor" href="#estimating-the-residual-variance"></a>
</h2>
<p>In the above examples, we set the residual variance to the value that
was used to simulated the data. In practice of course we will not have
access to this so we will have to estimate the residual variance
somehow.</p>
<p>When one has access to the summary data (specifically, the z-scores)
for a large pool of SNPs that are expected to have little to no effect
on the traits, one can use these z-scores to estimate the residual
variance. Here, in this example data set, we do not have access to a
large pool of “null SNPs”, but we can still use the data we have
available to obtain a rough estimate of the residual variance.
Specifically, we take as the “null SNPs” the SNPs in which the z-scores
are all less than 2 in magnitude:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Z</span> <span class="op">&lt;-</span> <span class="va">simdata</span><span class="op">$</span><span class="va">sumstats</span><span class="op">$</span><span class="va">z</span>
<span class="va">null_markers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span>,<span class="fl">1</span>,<span class="va">max</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">null_markers</span><span class="op">)</span>
<span class="va">Z</span> <span class="op">&lt;-</span> <span class="va">Z</span><span class="op">[</span><span class="va">null_markers</span>,<span class="op">]</span>
<span class="va">Vest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span>
<span class="co"># [1] 291</span></code></pre></div>
<p>The estimate of the residual covariance matrix using these SNPs is
reasonable, although presumably one could do better if we had the
z-scores for more SNPs that were not in LD with the causal SNPs:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>true <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">simdata</span><span class="op">$</span><span class="va">par</span><span class="op">$</span><span class="va">V</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">400</span><span class="op">)</span><span class="op">/</span><span class="fl">30</span>,
                   estimated <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">Vest</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pdat</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">true</span>,y <span class="op">=</span> <span class="va">estimated</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">20</span>,size <span class="op">=</span> <span class="fl">2.5</span>,color <span class="op">=</span> <span class="st">"royalblue"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span>,slope <span class="op">=</span> <span class="fl">1</span>,color <span class="op">=</span> <span class="st">"black"</span>,linetype <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/theme_cowplot.html" class="external-link">theme_cowplot</a></span><span class="op">(</span>font_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></code></pre></div>
<p><img src="mvsusie_intro_files/figure-html/compare-residual-estimate-1.png" width="360" style="display: block; margin: auto;"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Gao Wang, Yuxin Zou, Peter Carbonetto, Matthew
Stephens.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>
2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
